# wordpress
Тестовое задание WordPress и MySQL

Добрый день. 
Т.к. в тестовом задании не указано сколько ресурсов выделяется под данное приложение (и есть ли инфраструктура в котором оно будет выполняться) и не указано время безотказной работы (SLA), то я буду отталкиваться от минимального кол-ва ресурсов (один VPS 2-4 ядра, 4Gb ОЗУ). Но постараюсь упомянуть где можно вытести что то на другой сервер, увеличив тем самым надежность.

В этом репозитории не должно быть файла .env, в котором содержатся пароли. Этот файл должен быть добавлен  средсвами CI/CD (Jenkins, GitLab) при деплое.

Предполагается что разработчил, скачивает данный репозиторий и ведет разработку у себя на локальной машине. Т.к. с wordpress я до этого не работал, предполагаю что разработчик будет менять файлы в дирректории ./html  и запустив у себя на локальной машине контейнеры базы и wordpress (docker-compose up) будет ковырять что то в вэб интерфейсе на по адресу http://localhost:8080.
После того как он решил залить изменения в git, перед этим он выполняет скрипт scripts/make_dump_db.sh_. Этот скрипт скачает дамп базы заархивирует и запаролит его и положит в папку ./sql/ При последующих запусках init__db контейнер возмет этот файл распаролит, разархивирует и положит в контейнер  с базой. При запуске контейнера с базой этот дамп примениться. Это позволить, хранить состояние базы в гите. Так обычно не делают, хоть дамп и запаролен. Но, я исхожу из минимальной инфраструктуры.  

Запускать приложение в проде можно так (средствами Jenkins или Gitlab, или ,в худшем случае, руками на сервере):
```
docker-compose -f docker-compose.yaml -f docker-compose.prod.yaml up -d 
```

Для прод версии добавил контейнер с nginx. Не стал делать ssl соединение и автообновление сертификатов сертботом, хотя без этого никуда...

Все выше только если нет никакой инфраструктуры. Как нужно делать? (имея  инфраструктуру) 
Ну вопервых я бы не стал запускать базу в контейнере, а предпочел бы отдельный сервер для нее. А лучше два для dev и prod среды, или три, еще для выполнения тестов ))
Во вторых должен быть Jenkins или Gitlab CI/CD. Я предпочел бы первый, т.к. с гитлабом работал мало. Пишем CI джобу, которая собирает артифакты (дамп, и код) и отправляет это на хранение в Nexus или аналог. При этом делая версионирование дистрибутивов, с выставлением тега собранной версии в гите. Версионирование позволит быстро откатиться в предыдущее состояние в случае неудачи.  Тут надо подумать как делать, миграцию базы из dev в prod (и возможно обратно). Но это все зависит от специфики приложения.

Для nginx я бы тоже выделил отдельный сервер (load balancer), а не запускал бы его в контейнере.
Для выкатывания обновления из дистрибутива использовал бы Jenkis. Тут тоже все зависит от заданных параметров безотказной работы и наличия ресурсов. Можно выкатывать на отдельный сервер, прогонять тесты и если тесты проходят, делать переключение на nginx. Это обеспечит минимальный даунтайм приложения. 

Мониторить стоит:
 - ресурсы (сеть, диск, CPU, память) на машине на которой выполняется приложение,
 - кол-во соединений nginx для этого предпочел бы inflaxdb + Grafana, но можно (prometheus + grafana)
 - Логи nginx и wordpress и MySQL (ELK) 

Масштабировать можно увеличением экземпляров приложения (для этого и нужна база данных на отдельном сервере) и добавления балансировки на nginx. Ну или разворачивать кластер куба и перебираться туда. Но это уже другая история )) 

Спасибо за внимание))






